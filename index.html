<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>YACHT DICE FULL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQY-7LsLHb46Jk3A3IwL_IlpwosDqtVjUC79-vYQ7SMzQ&s=10" sizes="16Ã—16" type="image/png" />  
<style>
body{margin:0;background:#222;color:#fff;font-family:sans-serif;display:flex;justify-content:center;}
#game{max-width:420px;width:100%;padding:10px;}
button{padding:6px 10px;margin:4px;font-size:15px;}
.dice{font-size:38px;margin:4px;cursor:pointer;}
.hold{opacity:.4;}
table{border-collapse:collapse;margin:6px 0;}
td,th{border:1px solid #555;padding:4px;text-align:center;font-size:13px;}
.active{background:#0a0;}
.scoreWrap{overflow-x:auto;}
   footer {
           padding: 30px;
           text-align: center;
           font-size: 0.85rem;
           color: rgba(255,255,255,0.5);
           border-top: 1px solid rgba(255,255,255,0.1);
           margin-top: 60px;
   }
</style>
</head>

<body>
<div id="game">

<h2>ğŸ² ãƒ¨ãƒƒãƒˆãƒ€ã‚¤ã‚¹</h2>

<div id="setup">
äººæ•°:
<select id="players">
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
</select>

CPU:
<select id="cpu">
<option value="0">0</option>
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
</select>

é›£æ˜“åº¦:
<select id="cpuLevel">
<option value="easy">Easy</option>
<option value="normal">Normal</option>
<option value="hard">Hard</option>
<option value="lunatic">Lunatic</option>
</select>

<br><br>
<button onclick="startGame()">START</button>
</div>

<div id="play" style="display:none">
<h3 id="turn"></h3>

<div id="diceArea"></div>
<button onclick="roll()">ROLL</button>

<div>
<button onclick="saveGame()">ğŸ’¾ ã‚»ãƒ¼ãƒ–</button>
<button onclick="loadGame()">ğŸ“‚ ãƒ­ãƒ¼ãƒ‰</button>
<button onclick="deleteSave()">ğŸ—‘ å‰Šé™¤</button>
</div>

<div class="scoreWrap" id="scoreAll"></div>
</div>

</div>
   <footer>
       Â© 2025 STAR CORPORATION - All Rights Reserved.
   </footer>

<script>
let dice=[], hold=[], rolls=3;
let players=[], current=0;

const cats=["1","2","3","4","5","6","3D","4D","FH","SS","LS","Y","C"];

function rand(){return Math.floor(Math.random()*6)+1;}

function startGame(){
  const p=+playersEl.value;
  const c=+cpu.value;
  const lvl=cpuLevel.value;
  players=[];
  for(let i=0;i<p;i++){
    players.push({
      name:i<p-c?`P${i+1}`:`CPU${i+1}`,
      cpu:i>=p-c,
      level:lvl,
      score:{},
      yacht:0
    });
  }
  document.getElementById("setup").style.display="none";
  document.getElementById("play").style.display="block";
  nextTurn();
}

function nextTurn(){
  rolls=3;
  dice=Array.from({length:5},rand);
  hold=[false,false,false,false,false];
  draw();
  if(players[current].cpu) setTimeout(cpuPlay,600);
}

function roll(){
  if(rolls<=0)return;
  dice=dice.map((v,i)=>hold[i]?v:rand());
  rolls--;
  draw();
}

function draw(){
  document.getElementById("turn").textContent=
    players[current].name+" ã®ç•ªï¼ˆæ®‹ã‚Š"+rolls+"ï¼‰";

  const d=document.getElementById("diceArea");
  d.innerHTML="";
  dice.forEach((v,i)=>{
    const s=document.createElement("span");
    s.textContent=v;
    s.className="dice"+(hold[i]?" hold":"");
    s.onclick=()=>{hold[i]=!hold[i];draw();}
    d.appendChild(s);
  });

  drawScore();
}

function drawScore(){
  const wrap=document.getElementById("scoreAll");
  wrap.innerHTML="";
  players.forEach((p,i)=>{
    let t="<table"+(i===current?' class="active"':'')+">";
    t+=`<tr><th colspan="2">${p.name}</th></tr>`;
    cats.forEach(c=>{
      t+=`<tr><td>${c}</td><td>${p.score[c]??""}</td></tr>`;
    });
    let upper=["1","2","3","4","5","6"].reduce((s,k)=>s+(p.score[k]||0),0);
    t+=`<tr><td>ä¸Šæ®µ</td><td>${upper}</td></tr>`;
    t+=`<tr><td>ãƒœãƒ¼ãƒŠã‚¹</td><td>${upper>=63?35:0}</td></tr>`;
    let total=Object.values(p.score).reduce((a,b)=>a+(b||0),0)+(upper>=63?35:0);
    t+=`<tr><th>åˆè¨ˆ</th><th>${total}</th></tr>`;
    t+="</table>";
    wrap.innerHTML+=t;
  });
}

function choose(c){
  if(players[current].score[c]!=null)return;
  players[current].score[c]=calc(c);
  saveGame();
  current=(current+1)%players.length;
  nextTurn();
}

function calc(c){
  const cnt=[0,0,0,0,0,0];
  dice.forEach(v=>cnt[v-1]++);
  const sum=dice.reduce((a,b)=>a+b,0);

  if("123456".includes(c)) return cnt[c-1]*c;
  if(c==="3D") return cnt.some(v=>v>=3)?sum:0;
  if(c==="4D") return cnt.some(v=>v>=4)?sum:0;
  if(c==="FH") return cnt.includes(3)&&cnt.includes(2)?25:0;
  if(c==="SS") return ["1234","2345","3456"].some(s=>[...s].every(n=>cnt[n-1]))?30:0;
  if(c==="LS") return ["12345","23456"].some(s=>[...s].every(n=>cnt[n-1]))?40:0;
  if(c==="Y"){
    if(cnt.includes(5)){
      players[current].yacht++;
      return players[current].yacht>1?100:50;
    }
    return 0;
  }
  if(c==="C") return sum;
}

function cpuPlay(){
  const l=players[current].level;
  if(l==="easy"){ roll(); setTimeout(()=>choose(randCat()),400); }
  else if(l==="normal"){ roll(); roll(); setTimeout(()=>choose(bestCat()),500); }
  else{ roll(); roll(); roll(); setTimeout(()=>choose(bestCat()),600); }
}

function bestCat(){
  let b=null,m=-1;
  cats.forEach(c=>{
    if(players[current].score[c]==null){
      let v=calc(c);
      if(v>m){m=v;b=c;}
    }
  });
  return b;
}

function randCat(){
  const a=cats.filter(c=>players[current].score[c]==null);
  return a[Math.floor(Math.random()*a.length)];
}

/* ===== ã‚»ãƒ¼ãƒ–é–¢é€£ ===== */
function saveGame(){
  localStorage.setItem("yachtSave",JSON.stringify({
    players,current,dice,hold,rolls
  }));
}

function loadGame(){
  const d=localStorage.getItem("yachtSave");
  if(!d){alert("ã‚»ãƒ¼ãƒ–ãŒã‚ã‚Šã¾ã›ã‚“");return;}
  const s=JSON.parse(d);
  players=s.players; current=s.current;
  dice=s.dice; hold=s.hold; rolls=s.rolls;
  document.getElementById("setup").style.display="none";
  document.getElementById("play").style.display="block";
  draw();
}

function deleteSave(){
  if(!localStorage.getItem("yachtSave")){
    alert("ã‚»ãƒ¼ãƒ–ãŒã‚ã‚Šã¾ã›ã‚“");
    return;
  }
  if(confirm("ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
    localStorage.removeItem("yachtSave");
    alert("å‰Šé™¤ã—ã¾ã—ãŸ");
    location.reload();
  }
}
</script>
</body>
</html>
