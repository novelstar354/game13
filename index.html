<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>YACHT DICE ULTIMATE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ2hfa6mn-kAuE5rhjik7bwe6PzZ8oXsfc0Jy-2v19_MN24r8jwd9kUFdXP&s=10" sizes="16Ã—16" type="image/png" />  
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0}
h1{margin:10px}
#dice{display:flex;justify-content:center;gap:10px;margin:10px}
.die{width:60px;height:60px;background:#fff;color:#000;font-size:32px;line-height:60px;border-radius:10px;cursor:pointer}
.lock{background:gold}
.flash{animation:flash .5s}
@keyframes flash{0%{background:#fff}50%{background:gold}100%{background:#fff}}
button{padding:8px 14px;margin:4px;font-size:14px}
table{margin:auto;border-collapse:collapse}
td,th{border:1px solid #777;padding:5px}
.used{background:#444;color:#888}
.active{background:#264}
select{font-size:14px}
</style>
</head>
<body>

<h1>ğŸ² YACHT DICE ULTIMATE</h1>

äººæ•°:
<select id="playerCount" onchange="setup()">
<option value="2">2äºº</option>
<option value="3">3äºº</option>
<option value="4">4äºº</option>
</select>

<div id="playerSettings"></div>

<div id="dice"></div>
<button onclick="roll()">ROLL</button>
<p>æ®‹ã‚Šãƒ­ãƒ¼ãƒ«: <span id="rolls">3</span></p>

<table id="table"></table>

<br>
<button onclick="saveGame()">ğŸ’¾ ã‚»ãƒ¼ãƒ–</button>
<button onclick="loadGame()">ğŸ“‚ ãƒ­ãƒ¼ãƒ‰</button>
<button onclick="deleteSave()">ğŸ—‘ å‰Šé™¤</button>

<script>
const roles=["1","2","3","4","5","6","ã‚¹ãƒªãƒ¼","ãƒ•ã‚©ãƒ¼","ãƒ•ãƒ«","Sã‚¹ãƒˆ","Lã‚¹ãƒˆ","ãƒ¨ãƒƒãƒˆ","ãƒãƒ§ã‚¤ã‚¹"];
let players=[],turn=0,rolls=3;
let dice=[1,1,1,1,1],hold=[false,false,false,false,false];

function setup(){
 const n=+document.getElementById("playerCount").value;
 players=[];
 for(let i=0;i<n;i++){
  players.push({type:"human",ai:"easy",used:{},score:{},yacht:0});
 }
 renderPlayerSettings();
 buildTable();
 initDice();
}

function renderPlayerSettings(){
 let html="";
 players.forEach((p,i)=>{
  html+=`P${i+1}: 
  <select onchange="setType(${i},this.value)">
    <option value="human">äººé–“</option>
    <option value="cpu">CPU</option>
  </select>
  <select onchange="setAI(${i},this.value)">
    <option>easy</option><option>normal</option>
    <option>hard</option><option>lunatic</option>
  </select><br>`;
 });
 document.getElementById("playerSettings").innerHTML=html;
}

function setType(i,v){players[i].type=v}
function setAI(i,v){players[i].ai=v}

function buildTable(){
 let t=document.getElementById("table");
 t.innerHTML="";
 let h="<tr><th>å½¹</th>";
 players.forEach((_,i)=>h+=`<th>P${i+1}</th>`);
 h+="</tr>";
 t.innerHTML+=h;

 roles.forEach(r=>{
  let row=`<tr><td>${r}</td>`;
  players.forEach((_,i)=>row+=`<td id="p${i}_${r}">-</td>`);
  row+="</tr>";
  t.innerHTML+=row;
 });

 let b="<tr><td>ãƒœãƒ¼ãƒŠã‚¹</td>";
 players.forEach((_,i)=>b+=`<td id="b${i}">0</td>`);
 b+="</tr>";
 t.innerHTML+=b;

 let t2="<tr><td>åˆè¨ˆ</td>";
 players.forEach((_,i)=>t2+=`<td id="t${i}">0</td>`);
 t2+="</tr>";
 t.innerHTML+=t2;
}

function initDice(){
 const d=document.getElementById("dice");
 d.innerHTML="";
 for(let i=0;i<5;i++){
  let e=document.createElement("div");
  e.className="die";
  e.onclick=()=>toggle(i);
  d.appendChild(e);
 }
 draw();
}

function roll(){
 if(rolls<=0) return;
 for(let i=0;i<5;i++) if(!hold[i]) dice[i]=Math.floor(Math.random()*6)+1;
 rolls--;
 draw();
 if(players[turn].type==="cpu") setTimeout(cpuPlay,500);
}

function toggle(i){ if(players[turn].type==="human"){ hold[i]=!hold[i]; draw(); } }

function draw(){
 document.querySelectorAll(".die").forEach((d,i)=>{
  d.textContent=dice[i];
  d.className="die"+(hold[i]?" lock":"");
 });
 document.getElementById("rolls").textContent=rolls;
 highlight();
}

function highlight(){
 document.querySelectorAll("td").forEach(e=>e.classList.remove("active"));
 document.querySelectorAll(`#table tr td:nth-child(${turn+2})`).forEach(e=>e.classList.add("active"));
}

function score(role){
 if(players[turn].used[role]) return;
 let cnt={}; dice.forEach(d=>cnt[d]=(cnt[d]||0)+1);
 let s=0;

 if("123456".includes(role)) s=dice.filter(d=>d==role).reduce((a,b)=>a+b,0);
 else if(role==="ã‚¹ãƒªãƒ¼") s=Object.values(cnt).some(v=>v>=3)?sum():0;
 else if(role==="ãƒ•ã‚©ãƒ¼") s=Object.values(cnt).some(v=>v>=4)?sum():0;
 else if(role==="ãƒ•ãƒ«") s=Object.values(cnt).sort().join()=="2,3"?25:0;
 else if(role==="Sã‚¹ãƒˆ") s=["1234","2345","3456"].some(v=>v.split("").every(n=>dice.includes(+n)))?30:0;
 else if(role==="Lã‚¹ãƒˆ") s=["12345","23456"].some(v=>v.split("").every(n=>dice.includes(+n)))?40:0;
 else if(role==="ãƒ¨ãƒƒãƒˆ"){
   if(Object.values(cnt).some(v=>v==5)){
    players[turn].yacht++;
    s=players[turn].yacht==1?50:100;
    document.body.classList.add("flash");
    setTimeout(()=>document.body.classList.remove("flash"),400);
   }
 }
 else if(role==="ãƒãƒ§ã‚¤ã‚¹") s=sum();

 players[turn].used[role]=true;
 players[turn].score[role]=s;
 document.getElementById(`p${turn}_${role}`).textContent=s;

 nextTurn();
}

function nextTurn(){
 rolls=3;
 hold=[false,false,false,false,false];
 turn=(turn+1)%players.length;
 updateTotal();
 draw();
 if(players[turn].type==="cpu") setTimeout(cpuPlay,700);
}

function sum(){return dice.reduce((a,b)=>a+b,0)}

function updateTotal(){
 players.forEach((p,i)=>{
  let up=0;
  for(let n=1;n<=6;n++) up+=p.score[n]||0;
  let bonus=up>=63?35:0;
  document.getElementById("b"+i).textContent=bonus;
  let total=Object.values(p.score).reduce((a,b)=>a+b,0)+bonus;
  document.getElementById("t"+i).textContent=total;
 });
}

function cpuPlay(){
 let ai=players[turn].ai;
 if(ai==="easy"){ roll(); score("ãƒãƒ§ã‚¤ã‚¹"); return; }
 roll(); roll(); roll();
 const order=["ãƒ¨ãƒƒãƒˆ","Lã‚¹ãƒˆ","Sã‚¹ãƒˆ","ãƒ•ã‚©ãƒ¼","ãƒ•ãƒ«","ã‚¹ãƒªãƒ¼","ãƒãƒ§ã‚¤ã‚¹"];
 for(let r of order) if(!players[turn].used[r]){ score(r); return; }
}

function saveGame(){
 localStorage.setItem("yacht_save",JSON.stringify(players));
 alert("ä¿å­˜ã—ã¾ã—ãŸ");
}
function loadGame(){
 let d=localStorage.getItem("yacht_save");
 if(!d) return alert("ãƒ‡ãƒ¼ã‚¿ãªã—");
 players=JSON.parse(d);
 buildTable();
 updateTotal();
}
function deleteSave(){
 localStorage.removeItem("yacht_save");
 alert("å‰Šé™¤ã—ã¾ã—ãŸ");
}

setup();
</script>
</body>
</html>
