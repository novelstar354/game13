<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ¨ãƒƒãƒˆå®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body{margin:0;background:#111;color:#fff;font-family:sans-serif;text-align:center}
h1{margin:10px}
button{padding:10px 14px;margin:5px;font-size:16px;border-radius:8px;border:none}
select{font-size:16px;padding:6px}
#game,#result{display:none}
.dice{display:flex;justify-content:center;gap:10px;margin:10px}
.die{width:60px;height:60px;background:white;color:black;font-size:32px;
display:flex;align-items:center;justify-content:center;border-radius:10px;transition:.2s}
.die.hold{background:gold}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #555;padding:6px}
.used{background:#333;color:#888}
.turn{color:#6cf;font-size:18px;margin:5px}
#result h2{color:gold;font-size:28px}
.rank{font-size:18px}
</style>
</head>
<body>

<h1>ğŸ² ãƒ¨ãƒƒãƒˆå®Œå…¨ç‰ˆ</h1>

<div id="setup">
  ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°:
  <select id="pnum"><option>2</option><option>3</option><option>4</option></select><br><br>
  CPUäººæ•°:
  <select id="cpu"><option>0</option><option>1</option><option>2</option><option>3</option></select><br><br>
  CPUå¼·ã•:
  <select id="level">
    <option value="easy">Easy</option>
    <option value="normal">Normal</option>
    <option value="hard">Hard</option>
    <option value="lunatic">Lunatic</option>
  </select><br><br>
  <button onclick="startGame()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<div id="game">
  <div class="turn" id="turnText"></div>
  <div class="dice" id="dice"></div>
  <button onclick="rollDice()">ğŸ² æŒ¯ã‚‹</button>
  æ®‹ã‚Š <span id="rolls">3</span><br>
  <table id="score"></table><br>
  <button onclick="toggleSound()">ğŸ”Š éŸ³ <span id="soundState">ON</span></button>
  <button onclick="saveGame()">ğŸ’¾ ã‚»ãƒ¼ãƒ–</button>
  <button onclick="loadGame()">ğŸ“‚ ãƒ­ãƒ¼ãƒ‰</button>
</div>

<div id="result">
  <h2>ğŸ† å‹åˆ©ï¼</h2>
  <div id="winner"></div>
  <div id="ranking"></div><br>
  <button onclick="location.reload()">ğŸ” ã‚‚ã†ä¸€åº¦</button>
</div>

<script>
let players=[],current=0,rolls=3;
let dice=[1,1,1,1,1],hold=[false,false,false,false,false];
let soundOn=true;
const cats=["1","2","3","4","5","6","ãƒãƒ§ã‚¤ã‚¹","ãƒ•ã‚©ãƒ¼","ãƒ•ãƒ«","Sã‚¹ãƒˆ","Lã‚¹ãƒˆ","ãƒ¨ãƒƒãƒˆ"];

function sound(f){if(!soundOn)return;let a=new AudioContext(),o=a.createOscillator();o.frequency.value=f;o.connect(a.destination);o.start();o.stop(a.currentTime+.1);}

function startGame(){
  const p=+pnum.value,c=+cpu.value,l=level.value;
  players=[];
  for(let i=0;i<p;i++)
    players.push({name:i<p-c?`Player${i+1}`:`CPU${i+1}`,cpu:i>=p-c,level:l,score:{}});
  setup.style.display="none";
  game.style.display="block";
  nextTurn();
}

function nextTurn(){
  if(players.every(p=>Object.keys(p.score).length===cats.length)) return showResult();
  rolls=3; hold=[false,false,false,false,false];
  updateDice();
  turnText.textContent=players[current].name+" ã®ã‚¿ãƒ¼ãƒ³";
  updateTable();
  if(players[current].cpu) setTimeout(cpuPlay,500);
}

function rollDice(){
  if(rolls<=0) return;
  dice=dice.map((v,i)=>hold[i]?v:Math.floor(Math.random()*6)+1);
  rolls--; sound(500); updateDice();
}

function updateDice(){
  dice.forEach((v,i)=>{
    const d=document.getElementById("dice");
    d.innerHTML="";
    dice.forEach((v,i)=>{
      const e=document.createElement("div");
      e.className="die"+(hold[i]?" hold":"");
      e.textContent=v;
      e.onclick=()=>{hold[i]=!hold[i];updateDice();}
      d.appendChild(e);
    });
  });
  rollsElem.textContent=rolls;
}
const rollsElem=document.getElementById("rolls");

function calc(cat){
  const c=[0,0,0,0,0,0]; dice.forEach(v=>c[v-1]++);
  const sum=dice.reduce((a,b)=>a+b,0);
  if("123456".includes(cat)) return c[cat-1]*cat;
  if(cat=="ãƒãƒ§ã‚¤ã‚¹") return sum;
  if(cat=="ãƒ•ã‚©ãƒ¼") return c.some(v=>v>=4)?sum:0;
  if(cat=="ãƒ•ãƒ«") return c.includes(3)&&c.includes(2)?25:0;
  if(cat=="Sã‚¹ãƒˆ") return ["1234","2345","3456"].some(s=>s.split("").every(n=>c[n-1]));
  if(cat=="Lã‚¹ãƒˆ") return ["12345","23456"].some(s=>s.split("").every(n=>c[n-1]));
  if(cat=="ãƒ¨ãƒƒãƒˆ") return c.includes(5)?50:0;
  return 0;
}

function choose(cat){
  players[current].score[cat]=calc(cat);
  current=(current+1)%players.length;
  nextTurn();
}

function updateTable(){
  score.innerHTML="<tr><th>å½¹</th>"+players.map(p=>`<th>${p.name}</th>`).join("")+"</tr>";
  cats.forEach(c=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${c}</td>`;
    players.forEach((p,i)=>{
      const td=document.createElement("td");
      if(p.score[c]!=null){td.textContent=p.score[c];td.className="used";}
      else if(i===current){td.textContent="é¸æŠ";td.onclick=()=>choose(c);}
      tr.appendChild(td);
    });
    score.appendChild(tr);
  });
}

function cpuPlay(){
  const lv=players[current].level;
  if(lv==="easy"){rollDice();return choose(randCat());}
  if(lv==="normal"){rollDice();if(Math.random()<0.5) holdBest();return choose(bestCat());}
  if(lv==="hard"){for(let i=0;i<2;i++){rollDice();holdBest();}return choose(bestCat());}
  if(lv==="lunatic"){for(let i=0;i<3;i++){rollDice();smartHold();}return choose(bestCat());}
}

function randCat(){return cats.filter(c=>!players[current].score[c])[Math.floor(Math.random()*10)];}
function bestCat(){let b=null,m=-1;cats.forEach(c=>{if(players[current].score[c]==null){let v=calc(c);if(v>m){m=v;b=c;}}});return b;}
function holdBest(){let cnt=[0,0,0,0,0,0];dice.forEach(v=>cnt[v-1]++);let m=cnt.indexOf(Math.max(...cnt))+1;dice.forEach((v,i)=>hold[i]=v===m);}
function smartHold(){let cnt=[0,0,0,0,0,0];dice.forEach(v=>cnt[v-1]++);let s=cnt.map((v,i)=>({v,i})).sort((a,b)=>b.v-a.v);dice.forEach((v,i)=>hold[i]=(v===s[0].i+1||v===s[1].i+1));}

function showResult(){
  game.style.display="none";
  result.style.display="block";
  let rank=[...players].map(p=>({name:p.name,score:Object.values(p.score).reduce((a,b)=>a+b,0)}));
  rank.sort((a,b)=>b.score-a.score);
  winner.textContent=`ğŸ‘‘ å‹è€…: ${rank[0].name} (${rank[0].score}ç‚¹)`;
  ranking.innerHTML=rank.map((p,i)=>`${i+1}ä½: ${p.name} ${p.score}ç‚¹`).join("<br>");
  sound(800);
}

function toggleSound(){
  soundOn=!soundOn;
  soundState.textContent=soundOn?"ON":"OFF";
}
function saveGame(){localStorage.setItem("yacht_save",JSON.stringify({players,current}));alert("ä¿å­˜ã—ã¾ã—ãŸ");}
function loadGame(){let d=JSON.parse(localStorage.getItem("yacht_save"));if(!d)return;players=d.players;current=d.current;setup.style.display="none";game.style.display="block";nextTurn();}
</script>
</body>
</html>
